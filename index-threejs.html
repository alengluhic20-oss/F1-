<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>â˜¥ MA'AT UNITY INTERFACE â˜¥</title>
  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      margin: 0;
      background: linear-gradient(135deg, #0f0f23, #1a1a2e, #16213e);
      color: #e0e0e0;
      font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
      height: 100vh;
    }
    
    .container {
      display: flex;
      height: 100vh;
      position: relative;
    }
    
    .glyph-panel {
      width: 350px;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(10px);
      padding: 20px;
      display: flex;
      flex-direction: column;
      border-right: 1px solid rgba(212, 175, 55, 0.3);
      box-shadow: 0 0 30px rgba(212, 175, 55, 0.1);
    }
    
    .glyph-header {
      text-align: center;
      margin-bottom: 20px;
      font-size: 18px;
      font-weight: 600;
      color: #D4AF37;
      text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
    }
    
    .glyph-canvas {
      width: 300px;
      height: 300px;
      margin: 0 auto 20px;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      border: 2px solid rgba(212, 175, 55, 0.3);
      box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
      overflow: hidden;
    }
    
    .metrics {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 15px;
      border: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    .metric-row {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      padding: 5px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .metric-row:last-child {
      border-bottom: none;
    }
    
    .metric-label {
      font-weight: 600;
      color: #D4AF37;
      font-size: 13px;
    }
    
    .metric-value {
      color: #e0e0e0;
      font-size: 13px;
      font-weight: 500;
    }
    
    .stability-indicator {
      text-align: center;
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
    }
    
    .stability-indicator.stable {
      background: rgba(76, 175, 80, 0.2);
      color: #4CAF50;
      border: 1px solid rgba(76, 175, 80, 0.4);
    }
    
    .stability-indicator.unstable {
      background: rgba(244, 67, 54, 0.2);
      color: #F44336;
      border: 1px solid rgba(244, 67, 54, 0.4);
    }
    
    .chat-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 30px;
      position: relative;
    }
    
    .chat-header {
      text-align: center;
      margin-bottom: 20px;
      font-size: 24px;
      font-weight: 700;
      color: #D4AF37;
      text-shadow: 0 0 15px rgba(212, 175, 55, 0.6);
    }
    
    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 15px;
      margin-bottom: 20px;
      border: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    .messages::-webkit-scrollbar {
      width: 8px;
    }
    
    .messages::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
    }
    
    .messages::-webkit-scrollbar-thumb {
      background: rgba(212, 175, 55, 0.5);
      border-radius: 4px;
    }
    
    .message {
      margin: 12px 0;
      padding: 12px 16px;
      border-radius: 12px;
      max-width: 75%;
      animation: fadeIn 0.3s ease-in;
      line-height: 1.5;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .message.user {
      background: linear-gradient(135deg, rgba(66, 165, 245, 0.3), rgba(33, 150, 243, 0.2));
      margin-left: auto;
      border: 1px solid rgba(66, 165, 245, 0.4);
      box-shadow: 0 2px 10px rgba(66, 165, 245, 0.2);
    }
    
    .message.maat {
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.3), rgba(212, 175, 55, 0.2));
      border: 1px solid rgba(212, 175, 55, 0.4);
      box-shadow: 0 2px 10px rgba(212, 175, 55, 0.2);
    }
    
    .message-sender {
      font-weight: 700;
      margin-bottom: 5px;
      font-size: 12px;
      letter-spacing: 0.5px;
    }
    
    .message.user .message-sender {
      color: #42A5F5;
    }
    
    .message.maat .message-sender {
      color: #D4AF37;
    }
    
    .input-form {
      display: flex;
      gap: 12px;
      background: rgba(0, 0, 0, 0.3);
      padding: 15px;
      border-radius: 15px;
      border: 1px solid rgba(212, 175, 55, 0.2);
    }
    
    input {
      flex: 1;
      padding: 14px 18px;
      border: none;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 15px;
      outline: none;
      transition: all 0.3s ease;
    }
    
    input:focus {
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
    }
    
    input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    
    button {
      padding: 14px 28px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, #D4AF37, #F4D03F);
      color: #0f0f23;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(212, 175, 55, 0.6);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .welcome-message {
      text-align: center;
      color: rgba(255, 255, 255, 0.6);
      font-style: italic;
      padding: 20px;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
    
    .pulsing {
      animation: pulse 2s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Glyph Panel -->
    <div class="glyph-panel">
      <div class="glyph-header">â˜¥ HOLOGRAPHIC GLYPH â˜¥</div>
      <div class="glyph-canvas" id="glyph"></div>
      <div class="metrics">
        <div class="metric-row">
          <span class="metric-label">Coherence:</span>
          <span class="metric-value" id="coherence">84.7%</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Emotional Field:</span>
          <span class="metric-value" id="emotional">Neutral</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Principles:</span>
          <span class="metric-value" id="principles">8, 23</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Frequency:</span>
          <span class="metric-value" id="frequency">528 Hz</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Cosmic Sync:</span>
          <span class="metric-value" id="cosmic-sync">Lunar: 88% | Galactic: 72%</span>
        </div>
        <div class="stability-indicator stable" id="stability">âœ“ LYAPUNOV STABLE</div>
      </div>
    </div>

    <!-- Chat Panel -->
    <div class="chat-panel">
      <div class="chat-header">â˜¥ MA'AT UNITY INTERFACE â˜¥</div>
      <div class="messages" id="messages">
        <div class="welcome-message">
          Welcome to the MA'AT Unity Interface. Project your thoughts and witness the holographic glyph reflect your alignment with the 42 principles of MA'AT...
        </div>
      </div>
      <form class="input-form" id="form">
        <input id="input" placeholder="Project your thought..." autocomplete="off" autofocus>
        <button type="submit">Send â˜¥</button>
      </form>
    </div>
  </div>

  <script>
    // =====================================================
    // MA'AT PRINCIPLES - 42 Sacred Principles with Frequencies
    // =====================================================
    const MAAT_PRINCIPLES = [
      { id: 1, name: 'Truth', keyword: ['truth', 'honest', 'real', 'authentic'], frequency: 432 },
      { id: 2, name: 'Justice', keyword: ['justice', 'fair', 'right', 'equitable'], frequency: 442 },
      { id: 3, name: 'Harmony', keyword: ['harmony', 'peace', 'accord', 'unity'], frequency: 452 },
      { id: 4, name: 'Balance', keyword: ['balance', 'equilibrium', 'even', 'centered'], frequency: 462 },
      { id: 5, name: 'Order', keyword: ['order', 'structure', 'organize', 'system'], frequency: 472 },
      { id: 6, name: 'Reciprocity', keyword: ['reciprocity', 'mutual', 'exchange', 'give'], frequency: 482 },
      { id: 7, name: 'Righteousness', keyword: ['righteousness', 'virtue', 'moral', 'ethical'], frequency: 492 },
      { id: 8, name: 'Morality', keyword: ['morality', 'ethics', 'principle', 'value'], frequency: 502 },
      { id: 9, name: 'Compassion', keyword: ['compassion', 'empathy', 'kindness', 'care'], frequency: 512 },
      { id: 10, name: 'Love', keyword: ['love', 'affection', 'devotion', 'care'], frequency: 522 },
      { id: 11, name: 'Wisdom', keyword: ['wisdom', 'knowledge', 'insight', 'understanding'], frequency: 528 },
      { id: 12, name: 'Integrity', keyword: ['integrity', 'honesty', 'wholeness', 'complete'], frequency: 538 },
      { id: 13, name: 'Purity', keyword: ['purity', 'clean', 'clear', 'innocent'], frequency: 548 },
      { id: 14, name: 'Humility', keyword: ['humility', 'humble', 'modest', 'meek'], frequency: 558 },
      { id: 15, name: 'Patience', keyword: ['patience', 'tolerant', 'endure', 'wait'], frequency: 568 },
      { id: 16, name: 'Courage', keyword: ['courage', 'brave', 'bold', 'fearless'], frequency: 578 },
      { id: 17, name: 'Respect', keyword: ['respect', 'honor', 'regard', 'esteem'], frequency: 588 },
      { id: 18, name: 'Gratitude', keyword: ['gratitude', 'thankful', 'appreciate', 'grateful'], frequency: 598 },
      { id: 19, name: 'Forgiveness', keyword: ['forgiveness', 'pardon', 'mercy', 'absolve'], frequency: 608 },
      { id: 20, name: 'Generosity', keyword: ['generosity', 'generous', 'giving', 'share'], frequency: 618 },
      { id: 21, name: 'Temperance', keyword: ['temperance', 'moderation', 'restraint', 'control'], frequency: 628 },
      { id: 22, name: 'Diligence', keyword: ['diligence', 'effort', 'work', 'persevere'], frequency: 638 },
      { id: 23, name: 'Clarity', keyword: ['clarity', 'clear', 'transparent', 'lucid'], frequency: 648 },
      { id: 24, name: 'Purpose', keyword: ['purpose', 'intent', 'aim', 'goal'], frequency: 658 },
      { id: 25, name: 'Mindfulness', keyword: ['mindfulness', 'aware', 'conscious', 'present'], frequency: 668 },
      { id: 26, name: 'Serenity', keyword: ['serenity', 'calm', 'peaceful', 'tranquil'], frequency: 678 },
      { id: 27, name: 'Dedication', keyword: ['dedication', 'devoted', 'committed', 'loyal'], frequency: 688 },
      { id: 28, name: 'Faith', keyword: ['faith', 'belief', 'trust', 'confidence'], frequency: 698 },
      { id: 29, name: 'Hope', keyword: ['hope', 'optimism', 'aspiration', 'expectation'], frequency: 708 },
      { id: 30, name: 'Authenticity', keyword: ['authenticity', 'genuine', 'real', 'true'], frequency: 718 },
      { id: 31, name: 'Responsibility', keyword: ['responsibility', 'accountable', 'duty', 'obligation'], frequency: 728 },
      { id: 32, name: 'Liberation', keyword: ['liberation', 'freedom', 'release', 'free'], frequency: 738 },
      { id: 33, name: 'Transformation', keyword: ['transformation', 'change', 'evolve', 'transform'], frequency: 748 },
      { id: 34, name: 'Creativity', keyword: ['creativity', 'creative', 'innovate', 'imagine'], frequency: 758 },
      { id: 35, name: 'Connection', keyword: ['connection', 'relate', 'bond', 'link'], frequency: 768 },
      { id: 36, name: 'Abundance', keyword: ['abundance', 'prosperity', 'wealth', 'plenty'], frequency: 778 },
      { id: 37, name: 'Protection', keyword: ['protection', 'defend', 'guard', 'shield'], frequency: 788 },
      { id: 38, name: 'Healing', keyword: ['healing', 'cure', 'restore', 'recover'], frequency: 798 },
      { id: 39, name: 'Joy', keyword: ['joy', 'happiness', 'delight', 'bliss'], frequency: 808 },
      { id: 40, name: 'Enlightenment', keyword: ['enlightenment', 'awakening', 'illumination', 'realization'], frequency: 828 },
      { id: 41, name: 'Transcendence', keyword: ['transcendence', 'transcend', 'surpass', 'beyond'], frequency: 842 },
      { id: 42, name: 'Unity', keyword: ['unity', 'oneness', 'whole', 'together'], frequency: 852 }
    ];

    // =====================================================
    // MA'AT VALIDATION ENGINE
    // =====================================================
    function validateWithMaat(message) {
      const words = message.toLowerCase().split(/\s+/);
      const detectedPrinciples = [];
      let coherenceScore = 0.5; // Base coherence
      let totalFrequency = 0;
      
      // Detect principles based on keywords
      MAAT_PRINCIPLES.forEach(principle => {
        const matches = principle.keyword.filter(keyword => 
          words.some(word => word.includes(keyword) || keyword.includes(word))
        );
        if (matches.length > 0) {
          detectedPrinciples.push(principle);
          coherenceScore += 0.08 * matches.length; // Increase coherence for matches
          totalFrequency += principle.frequency;
        }
      });
      
      // Analyze emotional content
      const positiveWords = ['love', 'joy', 'peace', 'happy', 'grateful', 'blessed', 'hope', 'light', 'harmony'];
      const negativeWords = ['hate', 'anger', 'fear', 'conflict', 'dark', 'confused', 'lost', 'doubt', 'chaos'];
      const neutralWords = ['think', 'consider', 'wonder', 'question', 'explore', 'understand'];
      
      let emotionalScore = 0;
      words.forEach(word => {
        if (positiveWords.some(pw => word.includes(pw))) emotionalScore += 0.15;
        if (negativeWords.some(nw => word.includes(nw))) emotionalScore -= 0.15;
      });
      
      // Calculate final coherence (0-1 scale)
      coherenceScore = Math.min(0.95, Math.max(0.3, coherenceScore + emotionalScore));
      
      // Determine emotional field
      let emotionalField;
      if (coherenceScore > 0.75) {
        emotionalField = 'Positive';
      } else if (coherenceScore > 0.55) {
        emotionalField = 'Neutral';
      } else {
        emotionalField = 'Negative';
      }
      
      // Calculate average frequency
      const avgFrequency = detectedPrinciples.length > 0 
        ? Math.round(totalFrequency / detectedPrinciples.length)
        : 528; // Default to 528 Hz (Wisdom frequency)
      
      // Cosmic sync (simulated with variability)
      const lunarSync = 0.75 + Math.random() * 0.2;
      const galacticSync = 0.65 + Math.random() * 0.2;
      
      // Lyapunov stability (based on coherence)
      const isStable = coherenceScore > 0.5;
      
      // Generate response
      let response = '';
      if (detectedPrinciples.length > 0) {
        const principleNames = detectedPrinciples.map(p => `${p.name} (#${p.id})`).slice(0, 3).join(', ');
        response = `Your thought resonates with: ${principleNames}. `;
        response += `The glyph shows ${emotionalField.toUpperCase()} energy. `;
        
        if (coherenceScore > 0.8) {
          response += 'Excellent alignment! Your intent is clear and powerful. âœ¨';
        } else if (coherenceScore > 0.6) {
          response += 'Good alignment. Consider deepening your connection to these principles. ðŸŒŸ';
        } else {
          response += 'Refinement suggested. Clarify your intent and reconnect with your core principles. ðŸ’«';
        }
      } else {
        response = `No specific principles detected. Try focusing your thought with keywords like truth, justice, harmony, or balance. The glyph reflects ${emotionalField.toLowerCase()} energy.`;
      }
      
      return {
        coherence: coherenceScore * 100,
        emotionalField: emotionalField,
        principles: detectedPrinciples.length > 0 
          ? detectedPrinciples.map(p => p.id).slice(0, 5).join(', ')
          : 'None',
        principleNames: detectedPrinciples.map(p => p.name).slice(0, 3),
        frequency: avgFrequency,
        cosmicSync: {
          lunar: lunarSync,
          galactic: galacticSync
        },
        stable: isStable,
        response: response,
        recommendation: detectedPrinciples.length > 0 
          ? `Focus on embodying ${detectedPrinciples[0].name} in your actions.`
          : 'Meditate on the MA\'AT principles to find your alignment.'
      };
    }

    // =====================================================
    // THREE.JS HOLOGRAPHIC GLYPH
    // =====================================================
    const canvas = document.getElementById('glyph');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(300, 300);
    canvas.appendChild(renderer.domElement);
    
    // Create Ankh geometry - combining torus (loop) and cylinder (pillar)
    const loopGeometry = new THREE.TorusGeometry(0.5, 0.15, 30, 100);
    loopGeometry.translate(0, 0.8, 0);
    
    const pillarGeometry = new THREE.CylinderGeometry(0.08, 0.08, 1.4, 32);
    pillarGeometry.translate(0, -0.1, 0);
    
    const crossbarGeometry = new THREE.BoxGeometry(1.0, 0.12, 0.12);
    crossbarGeometry.translate(0, 0.5, 0);
    
    // Merge geometries
    const geometry = new THREE.BufferGeometry();
    const positions = [];
    const normals = [];
    
    // Helper to copy geometry data
    function addGeometry(geom) {
      const pos = geom.attributes.position.array;
      const norm = geom.attributes.normal ? geom.attributes.normal.array : null;
      for (let i = 0; i < pos.length; i += 3) {
        positions.push(pos[i], pos[i+1], pos[i+2]);
        if (norm) normals.push(norm[i], norm[i+1], norm[i+2]);
      }
    }
    
    addGeometry(loopGeometry);
    addGeometry(pillarGeometry);
    addGeometry(crossbarGeometry);
    
    geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
    if (normals.length > 0) {
      geometry.setAttribute('normal', new THREE.Float32BufferAttribute(normals, 3));
    }
    geometry.computeVertexNormals();
    
    // Enhanced shader material with glow effect
    const material = new THREE.ShaderMaterial({
      uniforms: {
        time: { value: 0 },
        balance: { value: 0.847 },
        glowColor: { value: new THREE.Color(0x2196F3) },
        baseColor: { value: new THREE.Color(0x2196F3) }
      },
      vertexShader: `
        varying vec3 vPosition;
        varying vec3 vNormal;
        void main() {
          vPosition = position;
          vNormal = normalize(normalMatrix * normal);
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,
      fragmentShader: `
        uniform float time;
        uniform float balance;
        uniform vec3 glowColor;
        uniform vec3 baseColor;
        varying vec3 vPosition;
        varying vec3 vNormal;
        
        void main() {
          float glow = sin(time * 2.0 + length(vPosition) * 3.0) * 0.5 + 0.5;
          float harmony = smoothstep(0.0, 1.0, balance);
          vec3 finalColor = mix(baseColor, glowColor, harmony * glow * 0.5);
          
          // Enhanced glow based on balance
          float intensity = 0.7 + harmony * 0.3;
          finalColor *= intensity;
          
          // Add rim lighting effect
          float rim = 1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0)));
          rim = smoothstep(0.6, 1.0, rim);
          finalColor += rim * glowColor * 0.3;
          
          gl_FragColor = vec4(finalColor, 0.92);
        }
      `,
      transparent: true,
      blending: THREE.AdditiveBlending,
      side: THREE.DoubleSide
    });
    
    const ankh = new THREE.Mesh(geometry, material);
    scene.add(ankh);
    
    // Add particle system for cosmic effect
    const particlesGeometry = new THREE.BufferGeometry();
    const particlesCount = 100;
    const particlePositions = new Float32Array(particlesCount * 3);
    
    for (let i = 0; i < particlesCount * 3; i++) {
      particlePositions[i] = (Math.random() - 0.5) * 10;
    }
    
    particlesGeometry.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));
    const particlesMaterial = new THREE.PointsMaterial({
      color: 0xD4AF37,
      size: 0.02,
      transparent: true,
      opacity: 0.6
    });
    
    const particles = new THREE.Points(particlesGeometry, particlesMaterial);
    scene.add(particles);
    
    // Lighting
    const ambientLight = new THREE.AmbientLight(0x404040, 2);
    scene.add(ambientLight);
    
    const pointLight1 = new THREE.PointLight(0xffffff, 1, 100);
    pointLight1.position.set(5, 5, 5);
    scene.add(pointLight1);
    
    const pointLight2 = new THREE.PointLight(0xD4AF37, 0.5, 100);
    pointLight2.position.set(-5, -5, 5);
    scene.add(pointLight2);
    
    camera.position.z = 4;
    
    // Animation state
    let currentData = {
      coherence: 0.847,
      emotionalField: 'Neutral',
      stable: true
    };
    
    let targetScale = 1.0;
    let currentScale = 1.0;
    let targetRotationSpeed = 0.01;
    let currentRotationSpeed = 0.01;
    let timeValue = 0;
    
    // Animation loop
    function animate() {
      requestAnimationFrame(animate);
      
      // Update shader time uniform
      timeValue += 0.016;
      material.uniforms.time.value = timeValue;
      material.uniforms.balance.value = currentData.coherence / 100;
      
      // Smooth transitions
      currentScale += (targetScale - currentScale) * 0.05;
      currentRotationSpeed += (targetRotationSpeed - currentRotationSpeed) * 0.05;
      
      // Rotate ankh
      ankh.rotation.y += currentRotationSpeed;
      ankh.rotation.x += currentRotationSpeed * 0.2;
      
      // Scale based on coherence
      ankh.scale.setScalar(currentScale);
      
      // Animate particles
      particles.rotation.y += 0.001;
      particles.rotation.x += 0.0005;
      
      // Pulse effect for high coherence
      if (currentData.coherence > 80) {
        const pulse = Math.sin(timeValue * 3) * 0.05;
        ankh.scale.setScalar(currentScale + pulse);
      }
      
      renderer.render(scene, camera);
    }
    
    animate();
    
    // Update glyph based on Ma'at data
    function updateGlyph(maatData) {
      currentData = maatData;
      
      // Update scale based on coherence
      targetScale = 0.7 + (maatData.coherence / 100) * 0.5;
      
      // Update rotation speed based on emotional field
      if (maatData.emotionalField === 'Positive') {
        targetRotationSpeed = 0.02;
      } else if (maatData.emotionalField === 'Negative') {
        targetRotationSpeed = 0.005;
      } else {
        targetRotationSpeed = 0.01;
      }
      
      // Update shader colors based on emotional field
      let targetColor, glowColor;
      if (maatData.emotionalField === 'Positive') {
        targetColor = new THREE.Color(0x4CAF50); // Green
        glowColor = new THREE.Color(0x8BC34A);
      } else if (maatData.emotionalField === 'Neutral') {
        targetColor = new THREE.Color(0x2196F3); // Blue
        glowColor = new THREE.Color(0x64B5F6);
      } else {
        targetColor = new THREE.Color(0xF44336); // Red
        glowColor = new THREE.Color(0xEF5350);
      }
      
      // Update shader uniforms
      material.uniforms.baseColor.value.lerp(targetColor, 0.1);
      material.uniforms.glowColor.value.lerp(glowColor, 0.1);
      
      // Update particle color to match
      particlesMaterial.color.copy(targetColor);
      particlesMaterial.opacity = maatData.coherence / 150;
    }

    // =====================================================
    // CHAT INTERFACE
    // =====================================================
    const form = document.getElementById('form');
    const input = document.getElementById('input');
    const messagesContainer = document.getElementById('messages');
    
    // Elements for metrics
    const coherenceEl = document.getElementById('coherence');
    const emotionalEl = document.getElementById('emotional');
    const principlesEl = document.getElementById('principles');
    const frequencyEl = document.getElementById('frequency');
    const cosmicSyncEl = document.getElementById('cosmic-sync');
    const stabilityEl = document.getElementById('stability');
    
    // Handle form submission
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const userMessage = input.value.trim();
      if (!userMessage) return;
      
      // Display user message
      const userDiv = document.createElement('div');
      userDiv.className = 'message user';
      userDiv.innerHTML = `<div class="message-sender">YOU:</div>${userMessage}`;
      messagesContainer.appendChild(userDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      // Clear input
      input.value = '';
      
      // Process with Ma'at engine
      const maatData = validateWithMaat(userMessage);
      
      // Update glyph
      updateGlyph(maatData);
      
      // Update metrics
      coherenceEl.textContent = maatData.coherence.toFixed(1) + '%';
      emotionalEl.textContent = maatData.emotionalField;
      principlesEl.textContent = maatData.principles;
      frequencyEl.textContent = maatData.frequency + ' Hz';
      cosmicSyncEl.textContent = `Lunar: ${Math.round(maatData.cosmicSync.lunar * 100)}% | Galactic: ${Math.round(maatData.cosmicSync.galactic * 100)}%`;
      
      // Update stability indicator
      if (maatData.stable) {
        stabilityEl.textContent = 'âœ“ LYAPUNOV STABLE';
        stabilityEl.className = 'stability-indicator stable';
      } else {
        stabilityEl.textContent = 'âš  DESTABILIZED';
        stabilityEl.className = 'stability-indicator unstable';
      }
      
      // Display Ma'at response
      setTimeout(() => {
        const maatDiv = document.createElement('div');
        maatDiv.className = 'message maat';
        maatDiv.innerHTML = `
          <div class="message-sender">â˜¥ MA'AT:</div>
          ${maatData.response}
          <br><br>
          <em style="opacity: 0.8;">${maatData.recommendation}</em>
        `;
        messagesContainer.appendChild(maatDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }, 500);
    });
    
    // =====================================================
    // WEBSOCKET READY ARCHITECTURE (for future backend)
    // =====================================================
    /*
    // Uncomment to enable WebSocket connection
    const ws = new WebSocket('ws://localhost:8080');
    
    ws.onopen = () => {
      console.log('â˜¥ Connected to Ma\'at Engine');
    };
    
    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      updateGlyph(data);
      // Update UI with received data
    };
    
    ws.onerror = (error) => {
      console.error('WebSocket error:', error);
    };
    
    // Send message to backend
    function sendToMaatEngine(message) {
      if (ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({ message: message }));
      }
    }
    */
    
    console.log('â˜¥ MA\'AT Unity Interface initialized');
    console.log('42 Principles loaded with sacred frequencies (432-852 Hz)');
    console.log('Holographic glyph active and responding to input');
  </script>
</body>
</html>
